<!DOCTYPE html>
<html>
<head>
    <title>COVID-19 Cases Comparison</title>
    <style>
        /* Style the chart container to make it larger */
        #chart_div {
            width: 100%;
            height: 500px;
            margin: 0 auto; /* Center the chart on the page */
        }
    </style>
</head>
<body>
    <h1>COVID-19 Cases Comparison</h1>
    <form id="countryForm">
        <!-- Country Drop-down -->
        <label for="country">Select a country:</label>
        <select id="country" name="country">
            {% for country in countries %}
                <option value="{{ country }}" {% if selected_country1 == country %}selected{% endif %}>{{ country }}</option>
            {% endfor %}
        </select>

        <!-- Table Drop-down -->
        <label for="table">Select a table:</label>
        <select id="table" name="table">
            <option value="confirmed" {% if selected_table == 'confirmed' %}selected{% endif %}>Confirmed Cases</option>
            <option value="deaths" {% if selected_table == 'deaths' %}selected{% endif %}>Deaths</option>
            <option value="recovery" {% if selected_table == 'recovery' %}selected{% endif %}>Recovery</option>
        </select>

        <button type="button" onclick="compareData()">Compare</button>
    </form>

    <!-- Chart container with larger dimensions -->
    <div id="chart_div"></div>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        // Loading the Google Charts package
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);

        // Sends a POST request to the server with the selected country and table and calls the function to draw the chart with the returned data
        function compareData() {
            const selectedCountry = document.getElementById("country").value;
            const selectedTable = document.getElementById("table").value;
            fetch("/compare", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    country: selectedCountry,
                    table: selectedTable
                })
            })
            .then(response => response.json())
            .then(data => {
                drawChartWithData(data, selectedCountry);
            })
            .catch(error => {
                console.error("Error fetching data:", error);
            });
        }

        // Draws a bar chart with the data for the selected country and table
        function drawChartWithData(data, country) {
            var dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Date');
            dataTable.addColumn('number', country);
            
            // Add data rows for the chart
            for (let item of data[country]) {
                dataTable.addRow([item.date, item.cases]);
            }

            // Sets options for the chart
            var options = {
                title: 'COVID-19 Cases for ' + country,
                legend: { position: 'top' },
                colors: ['blue'],
                bars: 'vertical',
                vAxis: { title: 'Cases' },
                hAxis: { title: 'Date', showTextEvery: 1, slantedText: true }
            };
            // Draws the chart in the specified div
            var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
            chart.draw(dataTable, options);
        }
    </script>
</body>
</html>






