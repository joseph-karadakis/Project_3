<!DOCTYPE html>
<html>
<head>
    <title>COVID-19 Cases Comparison</title>
    <style>
        /* Style the chart container to make it larger */
        #chart_div {
            width: 100%;
            height: 500px;
            margin: 0 auto; /* Center the chart on the page */
        }
    </style>
</head>
<body>
    <h1>COVID-19 Cases Comparison</h1>
    <form id="countryForm">
        <!-- Country 1 Drop-down -->
        <label for="country1">Select the first country:</label>
        <select id="country1" name="country1">
            {% for country in countries %}
                <option value="{{ country }}" {% if selected_country1 == country %}selected{% endif %}>{{ country }}</option>
            {% endfor %}
        </select>

        <!-- Country 2 Drop-down -->
        <label for="country2">Select the second country:</label>
        <select id="country2" name="country2">
            {% for country in countries %}
                <option value="{{ country }}" {% if selected_country2 == country %}selected{% endif %}>{{ country }}</option>
            {% endfor %}
        </select>

        <!-- Table Drop-down -->
        <label for="table">Select a table:</label>
        <select id="table" name="table">
            {% for table in tables %}
                <option value="{{ table }}" {% if selected_table == table %}selected{% endif %}>{{ table }}</option>
            {% endfor %}
        </select>

        <button type="button" onclick="compareData()">Compare</button>
    </form>

    <!-- Chart container with larger dimensions -->
    <div id="chart_div"></div>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        // Loading the Google Charts package
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);

        // Sends a POST request to the server with the selected countries and table and calls the function to draw the chart with the returned data
        function compareData() {
            const selectedCountry1 = document.getElementById("country1").value;
            const selectedCountry2 = document.getElementById("country2").value;
            const selectedTable = document.getElementById("table").value;
            fetch("/compare", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    country1: selectedCountry1,
                    country2: selectedCountry2,
                    table: selectedTable
                })
            })
            .then(response => response.json())
            .then(data => {
                drawChartWithData(data);
            })
            .catch(error => {
                console.error("Error fetching data:", error);
            });
        }

        // Draws a bar chart with the data for the selected countries and table
        function drawChartWithData(data) {
            var dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Date');
            dataTable.addColumn('number', 'Country 1');
            dataTable.addColumn('number', 'Country 2');
            
            // Combines data for both countries into one array for the chart
            const dates = [...new Set([...data.Country1.map(item => item.date), ...data.Country2.map(item => item.date)])];
            for (let date of dates) {
                const casesCountry1 = data.Country1.find(item => item.date === date)?.cases || 0;
                const casesCountry2 = data.Country2.find(item => item.date === date)?.cases || 0;
                dataTable.addRow([date, casesCountry1, casesCountry2]);
            }
            // Sets options for the chart
            var options = {
                title: 'COVID-19 Cases Comparison',
                legend: { position: 'top' },
                colors: ['blue', 'red'],
                bars: 'vertical',
                vAxis: { title: 'Cases' },
                hAxis: { title: 'Date' }
            };
            // Draws the chart in the specified div
            var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
            chart.draw(dataTable, options);
        }
    </script>
</body>
</html>


